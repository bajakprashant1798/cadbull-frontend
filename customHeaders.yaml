# AWS Amplify Custom Headers and Caching Configuration
# Optimized for Next.js ISR pages and static assets

customHeaders:
  # Next.js Static Assets - Cache for 1 year (immutable)
  - pattern: "/_next/static/**"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"
      - key: "X-Content-Type-Options"
        value: "nosniff"

  # ⚠️ TEMPORARY: Assets still in Amplify (will move to Bunny CDN)
  # TODO: Remove these after S3 migration
  # - pattern: "/assets/**"
  #   headers:
  #     - key: "Cache-Control"
  #       value: "public, max-age=2592000, s-maxage=2592000"
  
  # - pattern: "**/*.{png,jpg,jpeg,gif,webp,svg,ico}"
  #   headers:
  #     - key: "Cache-Control"
  #       value: "public, max-age=2592000, s-maxage=2592000"

  # Homepage - Cache for 30 minutes (matches ISR revalidate: 1800)
  - pattern: "/"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=1800, s-maxage=1800, stale-while-revalidate=3600"

  # Profile Pages - Cache for 2 hours (matches ISR revalidate: 7200)
  - pattern: "/profile/author/*"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=7200, s-maxage=7200, stale-while-revalidate=14400"

  # Category Pages - Cache for 1 hour
  - pattern: "/category/*"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=3600, s-maxage=3600, stale-while-revalidate=7200"

  # Project Detail Pages - Cache for 1 hour
  - pattern: "/project/*"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=3600, s-maxage=3600, stale-while-revalidate=7200"

  # Search Results - Cache for 15 minutes
  - pattern: "/search*"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=900, s-maxage=900, stale-while-revalidate=1800"

  # API Routes - No cache for dynamic data
  - pattern: "/api/**"
    headers:
      - key: "Cache-Control"
        value: "no-cache, no-store, must-revalidate"
      - key: "Pragma"
        value: "no-cache"
      - key: "Expires"
        value: "0"

  # Admin Pages - No cache
  - pattern: "/admin/**"
    headers:
      - key: "Cache-Control"
        value: "no-cache, no-store, must-revalidate"

  # Auth Pages - Cache for 5 minutes
  - pattern: "/auth/**"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=300, s-maxage=300"

  # Static Pages - Cache for 24 hours
  - pattern: "/about"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400, stale-while-revalidate=172800"

  - pattern: "/contact"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400, stale-while-revalidate=172800"

  - pattern: "/privacy"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400, stale-while-revalidate=172800"

  - pattern: "/terms"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400, stale-while-revalidate=172800"

  # JavaScript and CSS bundles - Cache for 1 year
  - pattern: "**/*.{js,css}"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"

  # Fonts - Cache for 1 year
  - pattern: "**/*.{woff,woff2,ttf,eot}"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=31536000, immutable"

  # Sitemap and Robots - Cache for 24 hours
  - pattern: "/sitemap*.xml"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400"

  - pattern: "/robots.txt"
    headers:
      - key: "Cache-Control"
        value: "public, max-age=86400, s-maxage=86400"

  # Security Headers for all pages
  - pattern: "**"
    headers:
      - key: "X-Frame-Options"
        value: "DENY"
      - key: "X-Content-Type-Options"
        value: "nosniff"
      - key: "Referrer-Policy"
        value: "strict-origin-when-cross-origin"
      - key: "Permissions-Policy"
        value: "camera=(), microphone=(), geolocation=()"
